#!/bin/bash

# Initial Setup: 
echo -e "[❓] ANUBIX -  Enter Clients Name: \n"
sleep 3
clear
read client_name
clear
sleep 4 
echo "[👽] ANUBIX - is currently getting things setup" 
sleep 3 
cd ~/
mkdir $client_name
cd $client_name
mkdir  discovery documentation focused-penetration
mkdir ~/$client_name/discovery/hosts 
mkdir ~/$client_name/discovery/services 
mkdir ~/$client_name/documentation/logs  
mkdir ~/$client_name/documentation/screentshots
> ~/$client_name/discovery/ranges.txt
clear
echo "[😈]ANUBIX: Task Completed"
sleep 2
clear


cd ~/$client_name/
echo "[👽] Tree display of new directory structure created"
tree
sleep 5
clear


# Host Discovery Phase 1 (A)

# Retrieve current IP address
ip_address=$(hostname -I | awk '{print$1}')


# Display my IP address
clear
echo "[+] Current IP Address is: $ip_address"


# Cut IP one octet to search for active nodes on current subnet  
range=$(echo $ip_address | cut -d ":" -f 2 | cut -b 1-10)
sleep 2
clear


# Display Network to search for active nodes
echo "[+] Searching current LAN for all live nodes: $range"
sleep 2 
clear


# Use Subnet variable to search for active nodes 
for octet in `seq 1 254`; do 
ping -c 1 $range.$octet | grep "64 bytes" | cut -d " " -f 4 | tr -d ":" >> ~/$client_name/discovery/hosts/target.txt &
done
sleep 2
clear


# Locating CIDR information for current network
nmcli device show eth2 | awk '/IP4.ADDRESS/ {print $2}' > ~/$client_name/discovery/ranges.txt

# Display CIDR search details
echo '[+] Generating Nmap scan from "ranges.txt"'
sleep 5 
clear

# Display how many live targets on LAN
live=$(cat ~/$client_name/discovery/hosts/target.txt | wc -l)
echo "[+] Currently you have $live live targets!"
sleep 5
clear 
 
# Scan 5 RMI know ports with Nmap
nmap -Pn -n -p 22,80,443,2222,3389 -iL ~/$client_name/discovery/hosts/target.txt -oA ~/$client_name/discovery/hosts/rmisweep -PE
clear
clear
cd ~/$client_name && tree
sleep 5 
clear

# Results from RMI sweep grepping on "open" string 
rmiresults=$(cat ~/$client_name/discovery/hosts/rmisweep.gnmap | grep open | cut -d " " -f 2)
echo -e "[👽] RMI Results: \n $rmiresults \n"
sleep 6
clear







